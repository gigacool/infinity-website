---
import { ViewTransitions } from 'astro:transitions';
import SEO from "@/components/SEO.astro";
import Footer from "@/components/footer.astro";
import Navbar from "@/components/navbar/navbar.astro";
import StickyCTA from "@/components/StickyCTA.astro";
import CookieConsent from "@/components/CookieConsent.astro";
import { getTranslations } from "@/i18n/utils";
import type { Language } from "@/i18n/utils";
import "../styles/global.css";

export interface Props {
  title?: string;
  lang?: Language;
  description?: string;
  ogType?: string;
  noindex?: boolean;
  publishedDate?: string;
  author?: string;
}

const { title, lang = 'fr', description, ogType, noindex, publishedDate, author } = Astro.props;
const t = getTranslations(lang);

const defaultTitle = lang === 'fr'
  ? "Apprenez ce qui compte. Prouvez ce que vous savez."
  : "Learn what matters. Prove what you know.";

const defaultDescription = lang === 'fr'
  ? "n∞sia — Plateforme d'apprentissage gamifiée alimentée par l'IA. Apprenez ce qui compte. Prouvez ce que vous savez."
  : "n∞sia — AI-powered gamified learning platform. Learn what matters. Prove what you know. Stay ahead.";
---

<!doctype html>
<html lang={lang}>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/png" sizes="32x32" href="/Fav-32.png" />
    <meta name="generator" content={Astro.generator} />
    <link rel="alternate" type="application/rss+xml" title="n∞sia Blog" href="/rss.xml" />
    <ViewTransitions />

    <SEO
      title={title || defaultTitle}
      description={description || defaultDescription}
      type={ogType}
      noindex={noindex}
      publishedDate={publishedDate}
      author={author}
    />

    <!-- Organization Schema (all pages) -->
    <script type="application/ld+json" set:html={JSON.stringify({
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "n∞sia",
      "url": "https://infinity-website-psi.vercel.app",
      "logo": "https://infinity-website-psi.vercel.app/Fav-32.png",
      "description": "AI-powered gamified learning platform for professionals"
    })} />

    <slot name="head" />
  </head>
  <body>
    <a href="#main" class="skip-link">
      {t.accessibility.skip_to_content}
    </a>
    <div transition:name={`navbar-${lang}`} transition:animate="none">
      <Navbar lang={lang} />
    </div>
    <main id="main">
      <slot />
    </main>
    <div transition:name={`footer-${lang}`} transition:animate="none">
      <Footer lang={lang} />
    </div>
    <StickyCTA lang={lang} />
    <CookieConsent lang={lang} />
    <style is:global>
      /* Improve Page speed */
      /* https://css-tricks.com/almanac/properties/c/content-visibility/ */
      img {
        content-visibility: auto;
      }
    </style>
  </body>
</html>
